services:
  lifeos:
    build: .
    container_name: lifeos
    depends_on:
      - litellm
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      # Le decimos a tu app dónde está el cerebro ahora
      - OPENAI_API_KEY=sk-fake-key-bypass
      - GOOGLE_APPLICATION_CREDENTIALS=/app/src/config/credentials.json
    volumes:
      - .:/app

  litellm:
    image: ghcr.io/berriai/litellm:main-latest
    container_name: lifeos_litellm
    ports:
      - "4000:4000"
    volumes:
      - ./litellm_config.yaml:/app/config.yaml
    env_file:
      - .env
    # Arranca con debug para ver si saltan los fallbacks
    command: "--config /app/config.yaml --port 4000 --detailed_debug"


  qdrant:
    image: qdrant/qdrant:latest
    container_name: lifeos_qdrant
    ports:
      - "6333:6333" # REST API and Dashboard UI
      - "6334:6334" # gRPC Port (internal)
    volumes:
      - ./data/qdrant:/qdrant/storage
    environment:
      # If you want to secure locally, uncomment this:
      # - QDRANT__SERVICE__API_KEY=${QDRANT_API_KEY}
      - QDRANT__TELEMETRY_DISABLED=true
    restart: always